================================================================================
                        CRN PATTERNS: Visual Guide
================================================================================

PATTERN 1: GLOBAL CRN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Input:  x (B, N, D) - N points to flow
Context: c (B, Dc) - Single global vector
Output: dx (B, N, D)

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Encoder   â”‚
                    â”‚  (PointNet) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    c: (B, Dc)
                    Global Latent
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚  Global CRN  â”‚
                    â”‚   (AdaLN)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚ Broadcast to â”‚
                    â”‚  all N pts   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    dx: (B, N, D)

Use: PointNet, MaxPool, MeanPool encoders


PATTERN 2a: STRUCTURED CRN (POOL-BASED)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Input:  x (B, N, D) - N points to flow (N >> K)
Context: c (B, K, Dc) - K abstract latents
Output: dx (B, N, D)

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Encoder   â”‚
                    â”‚(Slot Attn)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                c: (B, K, Dc)
                K Slots/Latents
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚  Pool Kâ†’1   â”‚
                    â”‚ (max/mean)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    (B, cond_dim)
                    Global Cond
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚ Structured  â”‚
                    â”‚ CRN (AdaLN) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚ Broadcast to â”‚
                    â”‚  all N pts   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    dx: (B, N, D)

Use: Slot Attention, Perceiver (when N >> K)
Complexity: O(K) â†’ O(1)
Benefit: Efficient, aggregates all K latents


PATTERN 2b: STRUCTURED CRN (ATTENTION-BASED)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Input:  x (B, N, D) - N points to flow (N >> K)
Context: c (B, K, Dc) - K abstract latents
Output: dx (B, N, D)

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Encoder   â”‚
                    â”‚(Slot Attn)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                c: (B, K, Dc)
                K Slots/Latents
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
            â”‚  Point 1  â”‚   â”‚  Point N  â”‚
            â”‚cross-attn â”‚   â”‚cross-attn â”‚
            â”‚  to K     â”‚...â”‚  to K     â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                  â”‚               â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                   â”‚ Structured  â”‚
                   â”‚ CRN (Cross) â”‚
                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                   dx: (B, N, D)

Use: Slot Attention, Perceiver (when N >> K, need expressiveness)
Complexity: O(N Ã— K)
Benefit: Point-specific conditioning, high expressiveness


PATTERN 3: STRUCTURED CRN (DIRECT)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Input:  x (B, K, D) - K points to flow (N = K!)
Context: c (B, K, Dc) - K abstract latents
Output: dx (B, K, D)

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Encoder   â”‚
                    â”‚(Slot Attn)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                c: (B, K, Dc)
                K Slots/Latents
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Slot 1     â”‚   â”‚    Slot K       â”‚
        â”‚      â†“       â”‚   â”‚       â†“         â”‚
        â”‚   Point 1    â”‚...â”‚    Point K      â”‚
        â”‚   (1-to-1)   â”‚   â”‚    (1-to-1)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                 â”‚   Direct    â”‚
                 â”‚ CRN (AdaLN) â”‚
                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                 (Optional)
                 â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                 â”‚Self-Attn    â”‚
                 â”‚among K pts  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                 dx: (B, K, D)

Use: Sample one point per slot/component (N = K)
Complexity: O(K)
Benefit: Most efficient for N=K, natural 1-to-1 correspondence


================================================================================
                            KEY INSIGHT
================================================================================

K is NOT the number of input points!

K represents ABSTRACT LATENT REPRESENTATIONS:
  ğŸ° Slots from Slot Attention (object representations)
  ğŸ” Latent queries from Perceiver (learned features)
  ğŸ“Š Mixture components from GMM (distributional modes)
  â­ Abstract "super points" or collocation points

Typical sizes:
  N (input points) = 100-1000
  K (abstract latents) = 8-64

Exception: Direct CRNs where N = K (one point per latent)


================================================================================
                        DECISION FLOWCHART
================================================================================

                    What's your context shape?
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                               â”‚
         (B, Dc)                         (B, K, Dc)
      Single global                    K abstract latents
              â”‚                               â”‚
              â–¼                               â–¼
        Global CRN                  How many points (N)?
              â”‚                               â”‚
              â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                   â”‚                       â”‚
              â”‚                N >> K                   N = K
              â”‚              Many points            One per latent
              â”‚                   â”‚                       â”‚
              â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
              â”‚        â”‚                     â”‚            â”‚
              â”‚   Need point-          Efficient          â”‚
              â”‚   specific cond?       preferred?         â”‚
              â”‚        â”‚                     â”‚            â”‚
              â”‚        â–¼                     â–¼            â–¼
              â”‚   Attention-             Pool-        Direct
              â”‚   Based CRN              Based CRN     CRN
              â”‚   O(N Ã— K)               O(K)â†’O(1)     O(K)
              â”‚   High expr.             Efficient     1-to-1
              â”‚        â”‚                     â”‚            â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                       Choose your CRN!


================================================================================
                        COMPARISON TABLE
================================================================================

Pattern          Context      Input       Complexity   Best For
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Global           (B, Dc)      (B, N, D)   O(1)         Simple global cond
Pool-Based       (B, K, Dc)   (B, N, D)   O(K)â†’O(1)    Efficient structured
Attention-Based  (B, K, Dc)   (B, N, D)   O(N Ã— K)     Expressive point-spec
Direct           (B, K, Dc)   (B, K, D)   O(K)         One point per latent


================================================================================
                        EXAMPLE SCENARIOS
================================================================================

Scenario 1: PointNet â†’ 100 points
  Encoder: PointNet â†’ (B, 128)
  Sample: 100 points â†’ (B, 100, 2)
  CRN: Global CRN
  Why: Single global latent

Scenario 2: Slot Attention (K=8) â†’ 100 points
  Encoder: Slot Attention â†’ (B, 8, 64)
  Sample: 100 points â†’ (B, 100, 2)
  CRN: Pool-Based (efficient) OR Attention-Based (expressive)
  Why: N >> K, need to condition 100 points on 8 slots

Scenario 3: Slot Attention (K=8) â†’ 8 points
  Encoder: Slot Attention â†’ (B, 8, 64)
  Sample: 8 points â†’ (B, 8, 2)
  CRN: Direct CRN
  Why: N = K, one point per slot (1-to-1)

Scenario 4: GMM (K=10) â†’ 10 points
  Encoder: GMM â†’ (B, 10, 32)
  Sample: 10 points â†’ (B, 10, 2)
  CRN: Direct CRN
  Why: N = K, one point per component (1-to-1)


================================================================================
                        IMPLEMENTATION FILES
================================================================================

src/models/
â”œâ”€â”€ global_crn.py           â† Global CRNs (B, Dc)
â”‚   â”œâ”€â”€ GlobalAdaLNMLPCRN
â”‚   â”œâ”€â”€ GlobalDiTCRN
â”‚   â””â”€â”€ GlobalCrossAttentionCRN
â”‚
â”œâ”€â”€ structured_crn.py       â† Structured CRNs (B, K, Dc)
â”‚   â”œâ”€â”€ StructuredAdaLNMLPCRN          (Pool-Based)
â”‚   â”œâ”€â”€ StructuredDiTCRN               (Pool-Based)
â”‚   â”œâ”€â”€ StructuredCrossAttentionCRN    (Attention-Based)
â”‚   â”œâ”€â”€ DirectStructuredAdaLNMLPCRN    (Direct, N=K)
â”‚   â””â”€â”€ DirectStructuredDiTCRN         (Direct, N=K)
â”‚
â””â”€â”€ crn.py                  â† DEPRECATED (backward compat)


================================================================================
                        QUICK START
================================================================================

# Import based on your context shape
from src.models.global_crn import GlobalAdaLNMLPCRN
from src.models.structured_crn import (
    StructuredAdaLNMLPCRN,           # Pool-Based
    StructuredCrossAttentionCRN,     # Attention-Based
    DirectStructuredAdaLNMLPCRN      # Direct (N=K)
)

# Use based on your scenario
# See examples above or CRN_PATTERNS_SUMMARY.md


================================================================================
